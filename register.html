<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>基於blockly的遊戲-註冊</title>
    
    <style>
        button{
            font-size: 35px;
            line-height: 39px;
            font-weight: bold;
            margin: 9px 3px 0px;
            width: 47px;
            text-align: center;
/*            font-family: 'sans-serif', '微軟正黑體';*/
        }
        button:hover{
        }
    
        #idbox {
            padding-top: 10px;
            text-align: center;
            width: 580px;
            height: 360px;
            position: fixed;
            top: 85px;
            left: 10px;
            border: 2px #fff solid;
            border-radius: 6px;
        }

        #yourname{
            font-size: 35px;
            line-height: 45px;
            color: white;
            font-family: 'sans-serif', '微軟正黑體';
            position: relative;
        }
        
        #userid{
            text-align: center;
            width: 170px;
            height: 46px;
            color: black;
            font-size: 35px;
            line-height: 45px;
            font-family: 'Arial';
            background: white;
            border: 3px #ac0 solid;
            border-radius: 4px;
            position: absolute;
            left: 290px;
            top: 0px;
        }
        
        .selec{
            width: 100px;
            height: 130px;
/*            background: black;*/
            border: 2px solid #333;
            border-radius: 4px;
/*            padding: 2px;*/
            margin: 5px;
            float: left;
            margin-top: 20px;
        }
        img{
            width: 96px;
            height: 96px;
        }
        #rolebox{
            padding-top: 0px;
            padding-left: 10px;
            text-align: center;
            width: 580px;
            height: 370px;
            position: fixed;
            top: 85px;
            left: 620px;
            border: 2px #fff solid;
            border-radius: 6px;
        }
        .selec:hover{
            border: 2px #fff solid;
        }
        span{
            font-size: 24px;
            line-height: 26px;
            color: white;
            font-family: 'sans-serif', '微軟正黑體';
        }
        .selected{
            background-color: #282;
            border-color: #3e3;
        }
        .used{
            text-decoration:line-through;
            color:darkred;
        }
        
        #overlay {                     /* 覆蓋在最上層的 div */
            background-color: #000; /*or semitransparent image 半透明圖像*/
            color: #fff;
            opacity: 0.9;
/*            display: none;*/
            height: 656px;
            width: 1280px;
            position: absolute;
            top: 0px;
            left: 0px;
            z-index: 100;
            font-size: 75px;
            text-align: center;
            font-family: 'Comic Sans MS', sans-serif, '微軟正黑體';
            line-height: 105px;
        }
        
        #regist{
            line-height: 45px;
            width:120px;
            font-family: '微軟正黑體';
            position: fixed;
            left: 540px;
            top: 500px;
        }
        
        a img{ border: 2px solid #fff;  border-radius: 6px;}
        a img:hover{  border: 2px solid #0ff;  background-color: white;}
    </style>
</head>

<script src ="jquery-3.4.1.js"></script>
    
<script>
    let userName ='USER';           //預設名稱
    let userNum = 10;               //選取的角色的代號
    
    $(document).ready(function(){
        $('.selec').click(function(){
            selectsound.play();
            //console.log(this);
            if(accUsed[userNum]==0){
                $('.selec').removeClass('selected');
                $(this).addClass('selected');
            }else{
                $('.selec').removeClass('selected');
                alert("抱歉！這個角色已經有人使用了…");
                userName ='USER';           //預設名稱
                userNum = 10;
            }
                        
        });
    });
        
    function setName(n,name0){          //選定角色 存好角色的代號和名字
        userName = name0 ;
        userNum = n;
        console.log(userName);
    }
    
</script>
    
<script>
    let accUsed =[];                    // 0：表示帳號未被使用   1：表示帳號已被使用 
    
    bgmusic = new Audio('/sound/login_use.mp3');
    selectsound = new Audio('/sound/MenuSelect1_use.wav');
    click1 = new Audio('/sound/Click.1.use.wav');
    confirm1 = new Audio('/sound/59_confirm.wav');
    
    window.onload=readSheet;                    //網頁載入後，即執行讀取試算表資料
    function readSheet(){
            a = {
                data: 1,           //從第1欄開始讀    ??這個好像不需要了！
                sheetUrl: '',
                sheetTag: 'ACC',
                mode: 5   //讀取模式
            };
            $('#overlay').show();
            //console.log(a);
            $.get('https://script.google.com/macros/s/AKfycbwQX5Xknx6scXF33XpaH81dFvDencOWiq-KmaP7czgHWLJMRkxs/exec', a, function(data){
                    accUsed = data.split(',');
                    console.log(accUsed); 
                    
                    //$('#r01').html(data);
                    $('#overlay').html('<br>讀取完成<br>請按一下滑鼠');       //alert(0);
                    $('#overlay').click(  function(){                   //這麼做是為了避免自動播放音樂會產生錯誤
                        $('#overlay').hide(); 
                        bgmusic.play();     bgmusic.volume=0.3;
                        
                        for(i=0;i<10;i++){
                            if(accUsed[i]!=0){
                                let iid = "#u"+i ;
                                $(document).ready(function(){
                                    $(iid).addClass('used');
                                });
                            }
                        }
                        
                    } );
                }
            ); 
    }
    
    function regis(){                           //按下 註冊
        let getdata;
        let userID = document.getElementById('userid').textContent ;
        
        confirm1.play();
        
        if (userID.length <3){
            alert("抱歉！名字至少要 3個字！\n請更改你的名字。");
        }else if(userNum==10){
            alert("請選擇一個角色才能註冊。");
        }else{
                                        //先檢查該角色是否先被人佔用 若無，就將資料放上去，傳回註冊成功！
            let data5 = (userNum + 1) + "," + userID;       console.log(data5);
            a = {
                data: data5,           //從第 userNum + 1 欄讀取
                sheetUrl: '',
                sheetTag: 'ACC',
                mode: 6   //註冊模式
            };
            $('#overlay').html('<br>註冊帳號中<br>請稍候……');
            $('#overlay').show();
            $.get('https://script.google.com/macros/s/AKfycbwQX5Xknx6scXF33XpaH81dFvDencOWiq-KmaP7czgHWLJMRkxs/exec', a, function(data){
                    getdata = data;
                    
                    if(getdata != 'success'){
                        $('#overlay').html('抱歉！<br>您選的角色剛才被佔用了！<br>網頁將重新整理…');       //alert(0);
                        setTimeout( function(){ location.reload(); } , 3000 );
                        
                    }else{
                        $('#overlay').html('<br>註冊成功！將自動進入遊戲<br>請記住你的名字和角色<br>祝您遊戲愉快！');
                        setTimeout( function(){
                            location.href = "train/trainMenu.html" + "?" + userName + "?" + userID;
                        } , 3000 );
                    }
                }
            );            
            
        }
    }
</script>    
    
    
    
<body bgcolor="#333">
    &nbsp;<a href="index.html"><img title="回首頁" style="width: 60px; height:60px" src="pic/home2.png" /></a>
    <div id="overlay"><br>讀取資料中……</div>
    
    <button onclick="regis();" id="regist">註 冊</button>
    
    <div id="rolebox"><br>
    <div class="selec" onclick="setName(0,'YANG');"><img src="Character/YANG.png"/><span id="u0">楊樂多</span></div>
    <div class="selec" onclick="setName(1,'BOOK');"><img src="Character/BOOK.png"/><span id="u1">妙而書</span></div>
    <div class="selec" onclick="setName(2,'ZERO');"><img src="Character/ZERO.png"/><span id="u2">柯玲芬</span></div>
    <div class="selec" onclick="setName(3,'NPC');"><img src="Character/NPC.png"/><span id="u3">恩披西</span></div>
    <div class="selec" onclick="setName(4,'CINNA');"><img src="Character/CINNA.png"/><span id="u4">希茵娜</span></div> 
    <div class="selec" onclick="setName(5,'DEE');"><img src="Character/DEE.png"/><span id="u5">低惠貴</span></div>
    <div class="selec" onclick="setName(6,'WASH');"><img src="Character/WASH.png"/><span id="u6">席婉姬</span></div>
    <div class="selec" onclick="setName(7,'LUWAN');"><img src="Character/LUWAN.png"/><span id="u7">鄭祿完</span></div>
    <div class="selec" onclick="setName(8,'ADIDA');"><img src="Character/ADIDA.png"/><span id="u8">愛滴答</span></div>
    <div class="selec" onclick="setName(9,'DISNY');"><img src="Character/DISNY.png"/><span id="u9">敵視你</span></div> 
    </div>
    
    <div id="idbox">
    <button onclick="showText('0');">0</button>
    <button onclick="showText('1');">1</button>
    <button onclick="showText('2');">2</button>
    <button onclick="showText('3');">3</button>
    <button onclick="showText('4');">4</button>
    <button onclick="showText('5');">5</button>
    <button onclick="showText('6');">6</button>
    <button onclick="showText('7');">7</button>
    <button onclick="showText('8');">8</button>
    <button onclick="showText('9');">9</button> <br/>
    <button value="A" onclick="showText('A');">A</button>
    <button value="b" onclick="showText('B');">B</button>
    <button value="C" onclick="showText('C');">C</button>
    <button value="D" onclick="showText('D');">D</button>
    <button value="E" onclick="showText('E');">E</button>
    <button value="F" onclick="showText('F');">F</button>
    <button onclick="showText('G');">G</button>
    <button onclick="showText('H');">H</button>
    <button onclick="showText('I');">I</button>
    <button onclick="showText('J');">J</button> <br/>
    <button onclick="showText('K');">K</button>
    <button onclick="showText('L');">L</button>
    <button onclick="showText('M');">M</button>
    <button onclick="showText('N');">N</button>
    <button onclick="showText('O');">O</button>
    <button onclick="showText('P');">P</button>
    <button onclick="showText('Q');">Q</button>
    <button onclick="showText('R');">R</button>
    <button onclick="showText('S');">S</button>
    <button onclick="showText('T');">T</button> <br/>
    <button onclick="showText('U');">U</button>
    <button onclick="showText('V');">V</button>    
    <button onclick="showText('W');">W</button>
    <button onclick="showText('X');">X</button> 
    <button onclick="showText('Y');">Y</button>
    <button onclick="showText('Z');">Z</button> 
    <button onclick="showText('.');">.</button> 
    <button onclick="showText('_');">_</button> 
    <button style="width:103px" onclick="showText('back');">←</button> 
    <br><br><br>
        
    <div id="yourname">你的名字： 　　　　　<div id="userid"></div></div>
    
    </div>          <!-- idbox-->
</body>
    
<script>
    function showText(char){
        click1.play();
        let text0 = document.getElementById('userid').textContent;
        
        if (char=="back"){
            document.getElementById('userid').textContent = text0.substr(0, text0.length-1 );
        }
        else if(text0.length<5){
            document.getElementById('userid').textContent = text0 + char;
        }else{
            alert("最多只能輸入5個字");
        }
    }
</script>    
    
    
</html>